!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){const{BarLengthError:r,DupChordError:o,TraceError:i,VolumeError:a}=n(17);class s{static processPedal(e){const t=e.Content;let n,r;for(;n=t.findIndex(e=>"PedalPress"===e.Type),r=t.findIndex(e=>"PedalRelease"===e.Type),-1!==n;){if(-1===r){const r=e.Meta.Duration-t[n].StartTime;t.splice(n,1),t.slice(n).forEach(e=>e.Duration=r);break}for(;r<n;)t.splice(r,1),r=t.findIndex(e=>"PedalRelease"===e.Type),n-=1;const o=t[r].StartTime-t[n].StartTime;t.splice(r,1),t.splice(n,1),t.slice(n,r).forEach(e=>e.Duration=o)}}constructor(e,t,n,r=!1){this.isSubtrack=r,this.ID=e.ID,this.Instruments=e.Instruments,this.Libraries=n,this.Content=e.Content,this.Settings=t.extend(),this.Context={afterTie:!1,notesBeforeTie:[],startTime:0,pitchQueue:[],warnings:[]}}parseTrack(){this.preprocess();const e=this.parseTrackContent();return s.processPedal(e),this.isSubtrack?[e]:this.Instruments.map(t=>(null===t.Proportion&&(t.Proportion=1),{Instrument:t.Instrument,ID:this.ID?`${this.ID}#${t.Instrument}`:t.Instrument,Meta:e.Meta,Content:e.Content.map(e=>Object.assign({},e,{Volume:e.Volume*t.Proportion}))}))}mergeMacro(){let e=this.Content.length,t=0;for(;t<e;){const n=this.Content[t];if("Macrotrack"===n.Type||n.Name in this.Libraries.Track){const r=this.Libraries.Track[n.Name];this.Content.splice(t,1,...r),e+=r.length-1}else t+=1}}preprocess(){if(this.mergeMacro(),1===this.Content.length)return;const e=this.Content.pop(),t=this.Content.pop();"BarLine"===e.Type&&"BarLine"===t.Type?(t.Terminal=!0,this.Content.push(t)):("BarLine"===e.Type&&(e.Terminal=!0),this.Content.push(t),this.Content.push(e))}parseTrackContent(){const e=[];let t,n,o=0,i=!0;for(const a of this.Content)switch(a.Type){case"FUNCTION":case"Subtrack":if("FUNCTION"===a.Type){if(void 0===(t=this.Libraries.FunctionPackage.applyFunction(this,a)))continue}else t=new c(a,this.Settings,this.Libraries,this.Context.pitchQueue).parseTrack();t.Content.forEach(e=>{"Note"===e.Type&&(e.StartTime+=this.Context.startTime)}),this.Context.startTime+=t.Meta.Duration,this.Context.notesBeforeTie=t.Meta.NotesBeforeTie,this.Context.warnings.push(...t.Meta.Warnings.map(e=>(e.args[0]=this.ID,e.args[1].unshift(this.Content.indexOf(a)),e))),t.Meta.Single?i?(o+=t.Meta.Incomplete[0],this.isLegalBar(o)&&(i=!1,n=0)):(n+=t.Meta.Incomplete[0],this.isLegalBar(n)&&(n=0)):i?(o+=t.Meta.Incomplete[0],i=!1,n=t.Meta.Incomplete[1],this.isLegalBar(n)&&(n=0)):(n+=t.Meta.Incomplete[0],this.isLegalBar(n)||this.Context.warnings.push(new r(this.ID,[this.Content.indexOf(a)],n)),n=t.Meta.Incomplete[1],this.isLegalBar(n)&&(n=0)),e.push(...t.Content);break;case"Note":this.Context.notesBeforeTie=this.parseNote(a),i?o+=this.parseBeat(a):n+=this.parseBeat(a),e.push(...this.Context.notesBeforeTie.filter(t=>-1===e.indexOf(t)));break;case"Tie":this.Context.afterTie=!0;break;case"BarLine":i=!1,!0!==a.Terminal&&(this.isLegalBar(n)||this.Context.warnings.push(new r(this.ID,[this.Content.indexOf(a)],n)),n=0);break;case"PedalPress":case"PedalRelease":e.push({Type:a.Type,StartTime:this.Context.startTime})}this.isSubtrack||o+n===this.Settings.Bar||(o!==this.Settings.Bar&&this.Context.warnings.push(new r(this.ID,[0],o)),n!==this.Settings.Bar&&this.Context.warnings.push(new r(this.ID,[-1],n)));const a={Content:e,Meta:{Warnings:this.Context.warnings,PitchQueue:this.Context.pitchQueue,FadeIn:this.Settings.FadeIn,FadeOut:this.Settings.FadeOut,Duration:this.Context.startTime,Single:i,Incomplete:[o,n],NotesBeforeTie:this.Context.notesBeforeTie}};return this.isSubtrack||(a.Meta.toJSON=function(){return{FadeIn:this.FadeIn,FadeOut:this.FadeOut,Duration:this.Duration,Warnings:this.Warnings}}),a}isLegalBar(e){return void 0===e||e===this.Settings.Bar||0===e}parseNote(e){const t=[],n=60*this.parseBeat(e)/this.Settings.Speed,r=n*(1-this.Settings.Stac[e.Staccato]),s=e.VolOp.split("").reduce((e,t)=>e*t===">"?this.Settings.Accent:":"===t?this.Settings.Light:1,1),c=this.Settings.Volume*s,u=this.parseDeltaPitch(e.PitOp);if(1===e.Pitches.length&&"%"===e.Pitches[0].Degree)this.Context.pitchQueue.length>=this.Settings.Trace?t.push(...this.Context.pitchQueue[this.Context.pitchQueue.length-this.Settings.Trace]):this.Context.warnings.push(new i(this.ID,[this.Content.indexOf(e)],this.Settings.Trace));else for(const n of e.Pitches)if("0"!==n.Degree)if("x"===n.Degree)t.push(null);else if(""===n.Chord)t.push(this.parsePitch(n)+u);else{const e=this.parsePitch(n)+u;t.push(...this.parseChord(n).map(t=>t+e))}new Set(t).size!==t.length&&this.Context.warnings.push(new o(this.ID,[this.Content.indexOf(e)],t));const h=new Array(t.length).fill(c);0!==this.Settings.ConOct&&(t.push(...t.map(e=>e+12*this.Settings.ConOct)),h.push(...h.map(e=>e*this.Settings.ConOctVolume))),h.some(e=>e>1||e<0)&&this.Context.warnings.push(new a(this.ID,[this.Content.indexOf(e)],h)),t.length>0&&this.Context.pitchQueue.push(t.slice(0));const l=[];this.Context.afterTie&&(this.Context.afterTie=!1,this.Context.notesBeforeTie.forEach(e=>{const n=t.indexOf(e.Pitch);-1!==n&&e.Volume===h[n]&&(l.push(e),e.Duration+=r,t.splice(n,1),h.splice(n,1))}));for(var d=0,p=t.length;d<p;d++)l.push({Type:"Note",Pitch:t[d],Volume:h[d],Duration:r,StartTime:this.Context.startTime});return this.Context.startTime+=n,l}parseChord(e){return e.Chord.split("").reduce((e,t)=>{const n=[];return this.Libraries.Chord[t].forEach(([t,r,o])=>{t>0&&(t-=1),r>0?n.push(...e.slice(t,r).map(e=>e+o)):-1===r?n.push(...e.slice(t).map(e=>e+o)):n.push(...e.slice(t,r+1).map(e=>e+o))}),n},[0])}parsePitch(e){return this.Settings.Key+12*this.Settings.Octave+s.pitchDict[e.Degree]+this.parseDeltaPitch(e.PitOp)}parseDeltaPitch(e){return e.split("").reduce((e,t)=>e+s.pitchOperatorDict[t],0)}parseBeat(e){let t=1,n=0,r=0;const o=e.DurOp.length;for(;n<o;){switch(e.DurOp.charAt(n)){case"=":t/=4,n+=1;break;case"-":t+=1,n+=1;break;case"_":t/=2,n+=1;break;case".":for(r=1,n+=1;"."===e.DurOp.charAt(n);)r+=1,n+=1;t*=2-Math.pow(2,-r)}}return t*Math.pow(2,-this.Settings.Duration)}}s.pitchDict={1:0,2:2,3:4,4:5,5:7,6:9,7:11},s.pitchOperatorDict={"#":1,b:-1,"'":12,",":-12};class c extends s{constructor(e,t,n,r){super(e,t,n,!0),this.Repeat=e.Repeat,this.Context.pitchQueue=r.slice()}parseTrack(){return this.preprocess(),this.parseTrackContent(this.Content)}preprocess(){if(this.mergeMacro(),-1!==this.Repeat&&this.Content.length>=1){"BarLine"!==this.Content[this.Content.length-1].Type&&this.Content.push({Type:"BarLine",Skip:!1,Order:[0]})}if(this.Repeat>0){const e=[],t=this.Content.filter(e=>"BarLine"===e.Type&&0!==e.Order[0]),n=t.find(e=>0===e.Order.length);if(void 0!==n){const e=[].concat(...t.map(e=>e.Order));for(let t=1;t<this.Repeat;t++)-1===e.indexOf(t)&&n.Order.push(t)}for(let t=1;t<=this.Repeat;t++){let n=!1;for(const r of this.Content)"BarLine"!==r.Type||0===r.Order[0]?n||e.push(r):-1===r.Order.indexOf(t)?n=!0:(n=!1,e.push(r))}this.Content=e}else{const e=this.Content.findIndex(e=>!0===e.Skip);let t;-1===e?t=new Array(-this.Repeat).fill(this.Content):(t=new Array(-this.Repeat-1).fill(this.Content)).push(this.Content.slice(0,e)),this.Content=[].concat(...t)}}}e.exports={TrackParser:s,SubtrackParser:c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2);window.require(["vs/editor/editor.main"],()=>{Object(r.a)(),Object(r.b)()}),"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js")},function(e,t,n){"use strict";t.a=function(){window.monaco.languages.register({id:"smml",extensions:["sml"]}),window.monaco.editor.defineTheme("smml",{base:"vs-dark",inherit:!0,rules:i,colors:{}}),window.monaco.languages.setMonarchTokensProvider("smml",a),window.monaco.languages.registerDefinitionProvider("smml",{provideDefinition(e,t,n){const r=e.findMatches("@[A-Za-z0-9]+",!1,!0,!1,"",!0),o=r.find(e=>e.range.startLineNumber===t.lineNumber&&e.range.endLineNumber===t.lineNumber&&e.range.startColumn<=t.column&&e.range.endColumn>=t.column);if(!o)return;const i=e.findMatches(`<*${o.matches[0].slice(1)}*>`,!1,!1,!0,"",!1)[0];return{uri:e.uri,range:i.range}}}),window.monaco.languages.registerCompletionItemProvider("smml",{triggerCharacters:["<","@"],provideCompletionItems(e,t,n){const r=e.getValueInRange({startLineNumber:t.lineNumber,endLineNumber:t.lineNumber,startColumn:t.column-1,endColumn:t.column});if("<"===r)return[{label:"Piano",kind:window.monaco.languages.CompletionItemKind.Variable,documentation:"Piano",insertText:"Piano>"}];if("@"===r){const t=e.findMatches("<\\*([A-Za-z0-9]+)\\*>",!1,!0,!1,"",!0);return t.map(e=>({label:e.matches[1],kind:window.monaco.languages.CompletionItemKind.Variable,insertText:e.matches[1]}))}return[]}})},t.b=function(){const e=document.getElementById("container"),t=window.monaco.editor.createModel(localStorage.getItem("lastText"),"smml"),n=window.monaco.editor.create(e,{model:t,language:"smml",theme:"smml",folding:!1});n.addAction({id:"smml-save",label:"Save smml file",keybindings:[window.monaco.KeyMod.CtrlCmd|window.monaco.KeyCode.KEY_S],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run(e){const t=e.getValue();localStorage.setItem("lastText",t);const n=t.slice(0,t.indexOf("\n"));let o;o=""!==n&&n.startsWith("//")?n.slice(2).trim():"new_file";const i=new Blob([t],{type:"text/plain;charset=utf-8"});r.saveAs(i,`${o}.sml`)}}),n.addAction({id:"smml-play",label:"Play smml file",keybindings:[window.monaco.KeyMod.CtrlCmd|window.monaco.KeyCode.KEY_P],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run(e){const t=e.getValue();s instanceof o.a?s.value===t?s.toggle():(s.close(),(s=new o.a(t)).play()):(s=new o.a(t)).play()}}),addEventListener("resize",e=>{n.layout()}),addEventListener("beforeunload",e=>{const t=n.getValue();""!==t&&localStorage.setItem("lastText",t)}),e.addEventListener("drop",e=>{e.preventDefault();const t=e.dataTransfer;if(t.items&&"file"===t.items[0].kind){const e=t.items[0].getAsFile(),r=new FileReader;r.readAsText(e),r.onload=(()=>n.executeEdits("dnd",[{identifier:"drag & drop",range:new window.monaco.Range(1,1,n.getModel().getLineCount(),n.getModel().getLineMaxColumn(n.getModel().getLineCount())),text:r.result}]))}}),e.addEventListener("dragover",e=>e.preventDefault()),n.updateOptions({mouseWheelZoom:!0})};var r=n(3),o=(n.n(r),n(6));const i=[{token:"undef",foreground:"FF0000"},{token:"comment",foreground:"008800"},{token:"sfunc",foreground:"FF909B"},{token:"func",foreground:"FF909B"},{token:"instr",foreground:"bf00ff",fontStyle:"bold"},{token:"macro",foreground:"7CFC00"},{token:"macroIndicator",foreground:"bf00ff"},{token:"inc",foreground:"7CFC00"},{token:"incPath",foreground:"87CEFA"},{token:"degree",foreground:"00FFFF"},{token:"pitOp-chord",foreground:"00BBFF"},{token:"durOp-stac-volOp",foreground:"00FFBB"},{token:"chordBracket",foreground:"00BBBB"},{token:"@bracket",foreground:"fc8f00"},{token:"volta",foreground:"FFFF00"},{token:"barline",foreground:"fc8f00"},{token:"repeat",foreground:"FFFF00"},{token:"press-release",foreground:"fcde00"},{token:"tie",foreground:"fcde00"}],a={tokenizer:{root:[{regex:/\/\/.*/,action:{token:"comment"}},{regex:/# *Track/,action:{token:"@rematch",next:"Macro"}},{regex:/# *Chord/,action:{token:"@rematch",next:"ChordDef"}},{regex:/# *Include/,action:{token:"@rematch",next:"@Inc"}},{regex:/\[(\d+\.)+\]/,action:{token:"volta"}},{regex:/<[^*]+>/,action:{token:"instr"}},{include:"Common"}],Subtrack:[{regex:/\d+\*|\/\d*:/,action:{token:"repeat"}},{regex:/\//,action:{token:"repeat"}},{regex:/\^\)|\)/,action:{token:"@rematch",next:"@pop"}},{include:"Common"}],Common:[{regex:/@[A-Za-z\d]+/,action:{token:"macroIndicator"}},{regex:/(\$?)([\d%x])/,action:[{token:"func"},{cases:{"@eos":{token:"degree"},"@default":{token:"degree",next:"NoteOp"}}}]},{regex:/(\$?)(\[)/,action:[{token:"func"},{token:"@rematch",next:"Chord"}]},{regex:/\(/,action:{token:"@rematch",next:"Sfunc"}},{regex:/([A-Z][a-z]+)+\(/,action:{token:"@rematch",next:"Func"}},{regex:/{/,action:{bracket:"@open",token:"@bracket",next:"Subtrack"}},{regex:/}/,action:{bracket:"@close",token:"@bracket",next:"@pop"}},{regex:/&/,action:{token:"press-release"}},{regex:/\*/,action:{token:"press-release"}},{regex:/~/,action:{token:"func"}},{regex:/\^/,action:{token:"tie"}},{regex:/:\|\|:|:\|\||\|\|:|\|\||\|/,action:{token:"barline"}}],Sfunc:[{regex:/\(\.\)/,action:{token:"func",next:"@pop"}},{regex:/\(\^/,action:{token:"func",next:"Subtrack"}},{regex:/\(|\^|:|1=/,action:{token:"func"}},{regex:/{/,action:{token:"@bracket",next:"Subtrack"}},{regex:/[^)]+\^\)/,action:{token:"@rematch",next:"Subtrack"}},{regex:/\^\)/,action:{token:"func",next:"@pop"}},{regex:/\)/,action:{token:"func",next:"@pop"}},{regex:/[A-Za-zb#%\d.\-/]/,action:{token:"number"}}],Func:[{regex:/[A-Z][a-z]+/,action:{token:"func"}},{regex:/\(/,action:{token:"func",next:"Arg"}},{regex:/\)/,action:{token:"func",next:"@pop"}},{regex:/,\s*/,action:{token:"func",next:"Arg"}}],Array:[{regex:/\[/,action:{token:"func",bracket:"@open",next:"Arg"}},{regex:/,\s*/,action:{token:"func",next:"Arg"}},{regex:/\]/,action:{token:"func",bracket:"@close",next:"@pop"}}],Arg:[{regex:/{/,action:{token:"@bracket",next:"Subtrack"}},{regex:/"[^"]*"/,action:{token:"string"}},{regex:/\[/,action:{token:"@rematch",next:"Array"}},{regex:/,|\)|\]/,action:{token:"@rematch",next:"@pop"}},{regex:/[^,)}[\]"]+/,action:{token:"number"}}],NoteOp:[{regex:/[^',b#a-wyzA-Z\-_.=`:>]/,action:{token:"@rematch",next:"@pop"}},{include:"NoteAddon"}],NoteAddon:[{regex:/[',b#a-wyzA-Z]/,action:{cases:{"@eos":{token:"pitOp-chord",next:"@pop"},"@default":{token:"pitOp-chord"}}}},{regex:/[-_.=`:>]/,action:{cases:{"@eos":{token:"durOp-stac-volOp",next:"@pop"},"@default":{token:"durOp-stac-volOp"}}}}],Chord:[{regex:/\[/,action:{token:"@rematch",next:"ChordInside"}},{regex:/[^',b#a-wyzA-Z\-_.=`:>]/,action:{token:"@rematch",next:"@pop"}},{include:"NoteAddon"}],ChordInside:[{regex:/\[/,action:{token:"chordBracket"}},{regex:/[\d%]/,action:{token:"degree"}},{regex:/[',b#a-wyzA-Z]/,action:{token:"pitOp-chord"}},{regex:/\]/,action:{token:"chordBracket",next:"@pop"}}],ChordDef:[{regex:/# *Chord/,action:{token:"macro",bracket:"@open"}},{regex:/# *End/,action:{token:"macro",bracket:"@close",next:"@pop"}},{regex:/^.+$/,action:{token:"@rematch",next:"ChordDefLine"}}],ChordDefLine:[{regex:/^[a-wyzA-Z]/,action:{token:"pitOp-chord"}},{regex:/\t+[^\t]+\t+/,action:{token:"comment"}},{regex:/.*/,action:{token:"pitOp-chord",next:"@pop"}}],Macro:[{regex:/# *Track/,action:{token:"macro",bracket:"@open"}},{regex:/<\*[A-Za-z\d]+\*>/,action:{token:"macroIndicator"}},{regex:/# *End/,action:{token:"macro",bracket:"@close",next:"@pop"}},{include:"Common"}],Inc:[{regex:/# *Include/,action:{token:"inc"}},{regex:/".*"/,action:{token:"incPath",next:"@pop"}}],Section:[],Track:[]},tokenPostfix:".sml",defaultToken:"undef"};let s},function(e,t,n){var r,o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},n=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in n,o=/constructor/i.test(e.HTMLElement)||e.safari,i=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},s=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(u,h,l){l||(u=c(u));var d,p=this,g="application/octet-stream"===u.type,f=function(){!function(e,t,n){for(var r=(t=[].concat(t)).length;r--;){var o=e["on"+t[r]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){a(e)}}}(p,"writestart progress write writeend".split(" "))};if(p.readyState=p.INIT,r)return d=t().createObjectURL(u),void setTimeout(function(){var e,t;n.href=d,n.download=h,e=n,t=new MouseEvent("click"),e.dispatchEvent(t),f(),s(d),p.readyState=p.DONE});!function(){if((i||g&&o)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=i?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,f()},n.readAsDataURL(u),void(p.readyState=p.INIT)}d||(d=t().createObjectURL(u)),g?e.location.href=d:e.open(d,"_blank")||(e.location.href=d);p.readyState=p.DONE,f(),s(d)}()},h=u.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,n){return new u(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==e&&e.exports?e.exports.saveAs=o:null!==n(4)&&null!==n(5)&&(void 0===(r=function(){return o}.call(t,n,t,e))||(e.exports=r))},function(e,t){e.exports=function(){throw new Error("define cannot be used indirect")}},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){"use strict";var r=n(7),o=(n.n(r),n(9)),i=(n.n(o),n(14)),a=(n.n(i),n(22));window.fonts=window.fonts||{};t.a=class{constructor(e){this.value=e,this.tracks=new i.Parser(new r.Tokenizer(e).tokenize(),new i.MIDIAdapter).parse(),this.ctx=new AudioContext,this.player=new o.Player,this.status=0}play(){if(1===status)return;this.status=1;const e=this.tracks.map(e=>e.Instrument);var t;Promise.all(e.map(e=>this.player.loader.load(this.ctx,(e=e,""===e&&(e=a.b),e in a.d?a.a+("00"+a.d[e].toString()).slice(-3)+"0_FluidR3_GM_sf2_file.json":a.a+"128"+a.c[e].toString()+"_0_FluidR3_GM_sf2_file.json"),function(e){return""===e&&(e=a.b),e in a.d?"_tone_"+("00"+a.d[e].toString()).slice(-3)+"0_FluidR3_GM_sf2_file":"_drum_"+a.c[e].toString()+"_0_FluidR3_GM_sf2_file"}(e)))).then(e=>{const t=this.ctx.currentTime;for(var n=0,r=this.tracks.length;n<r;n++){const r=this.tracks[n].Content;for(var o=0,i=r.length;o<i;o++)"Note"===r[o].Type&&this.player.queueWaveTable(this.ctx,this.ctx.destination,window.fonts[e[n]],r[o].StartTime+t,null===r[o].Pitch?a.c[this.tracks[n].Instrument]:r[o].Pitch+60,r[o].Duration,r[o].Volume)}})}suspend(){2!==this.status&&(this.status=2,this.ctx.suspend())}resume(){1!==status&&(this.status=1,this.ctx.resume())}close(){3!==this.status&&(this.status=3,this.ctx.close())}toggle(){switch(this.status){case 0:this.play();break;case 1:this.suspend();break;case 2:this.resume()}}}},function(e,t,n){const r=n(8);e.exports={Tokenizer:r}},function(e,t){const n={root:[{regex:/^\[(\d+\.)+\]/,action:{token:"volta",transform:e=>({Type:"Volta",Order:e[0].slice(1,-1).split(".").slice(0,-1).map(e=>Number(e))})}},{regex:/^<([A-Za-z0-9]+:)?([A-Za-z0-9]+(\(.+\))?)(,[A-Za-z0-9]+(\(.+\))?)*>/,action:{token:"instr",transform(e){const t=e[2].split(",").map(e=>{const t=e.match(/(\w+)(\(\d+%\))?/);return{Instrument:t[1],Proportion:void 0===t[2]?null:Number(t[2].slice(1,-2))/100}});return t.unshift(e[1].slice(0,-1)),t}}},{regex:/^@[a-z]+/,action:{token:"macroIndicator",transform:e=>({Type:"Macrotrack",Name:e[0].slice(1)})}},{regex:/^([A-Za-z]\w*)\s*\(/,action:{token:"func",next:"Func",transform:(e,t)=>({Type:"FUNCTION",Name:e[1],Argument:t})}},{regex:/^{(\d+\*)?/,action:{token:"subtrack",next:"root",transform(e,t){let n;if(void 0!==e[1])n=e[1].slice(0,-1);else{const e=t.filter(e=>"BarLine"===e.Type&&e.Order[0]>0);n=e.length>0?Math.max(...e.map(e=>Math.max(...e.Order))):-1}return{Type:"Subtrack",Repeat:n,Content:t}}}},{regex:/^}/,action:{token:"@pass",next:"@pop"}},{regex:/^&/,action:{token:"pr",transform:()=>({Type:"PedalPress"})}},{regex:/^\*/,action:{token:"pr",transform:()=>({Type:"PedalRelease"})}},{regex:/^\^/,action:{token:"tie",transform:()=>({Type:"Tie"})}},{regex:/^(:\|\|:|:\|\||\|\|:|\||\/([\d,~\s])*:|\/)/,action:{cases:{":||:":{token:"rEB"},":||":{token:"rE",transform:()=>({Type:"RepeatEnd"})},"||:":{token:"rB",transform:()=>({Type:"RepeatBegin"})},"|":{token:"ba",transform:()=>({Type:"BarLine",Skip:!1,Order:[0]})},"/":{token:"skip",transform:()=>({Type:"BarLine",Skip:!0,Order:[0]})},"@default":{token:"pos",transform(e){let t=[];if(void 0!==e[1]){const r=e[1].split(",");for(const e of r)if(e.includes("~")){const[r,o]=e.split("~");for(var n=r;n<=o;n++)t.push(n)}else t.push(Number(e))}return{Type:"BarLine",Skip:!1,Order:t}}}}}},{regex:/^([0-7x%])([',#b]*)([A-Zac-z]*)([',#b]*)([-_.=]*)(`*)([:>]*)/,action:{token:"note",transform:e=>({Type:"Note",Pitches:[{Degree:e[1],PitOp:void 0===e[2]?"":e[2],Chord:void 0===e[3]?"":e[3]}],PitOp:void 0===e[4]?"":e[4],DurOp:void 0===e[5]?"":e[5],VolOp:void 0===e[7]?"":e[7],Staccato:void 0===e[6]?0:e[6].length})}},{regex:/^\[(([0-7x%][',#A-Za-z]*)+)\]([',#b]*)([-_.=]*)(`*)([:>]*)/,action:{token:"chord",transform:e=>({Type:"Note",Pitches:e[1].match(/[0-7x%][',#A-Za-z]*/g).map(e=>{const t=e.match(/([0-7x%])([',#b]*)([ac-zA-Z]*)/);return{Degree:t[1],PitOp:void 0===t[2]?"":t[2],Chord:void 0===t[3]?"":t[3]}}),PitOp:void 0===e[3]?"":e[3],DurOp:void 0===e[4]?"":e[4],VolOp:void 0===e[6]?"":e[6],Staccato:void 0===e[5]?0:e[5].length})}}],Func:[{regex:/^\)/,action:{token:"@pass",next:"@pop"}},{regex:/^,\s*/,action:{token:"@pass"}},{regex:/^{(\d+\*)?/,action:{token:"subtrack",next:"root",transform(e,t){let n;if(void 0!==e[1])n=e[1].slice(0,-1);else{const e=t.filter(e=>"BarLine"===e.Type&&e.Order[0]>0);n=e.length>0?Math.max(...e.map(e=>Math.max(...e.Order))):-1}return{Type:"Subtrack",Repeat:n,Content:t}}}},{regex:/^"([^"]*)"/,action:{token:"string",transform:e=>({Type:"String",Content:e[1]})}},{regex:/^\[/,action:{token:"array",next:"Array",transform:(e,t)=>({Type:"Array",Content:t})}},{regex:/^[^,)}[\]"]+/,action:{token:"number",transform:e=>({Type:"Expression",Content:e[0]})}}],Array:[{regex:/^,\s*/,action:{token:"@pass"}},{regex:/^\]/,action:{token:"@pass",next:"@pop"}},{regex:/^{(\d+\*)?/,action:{token:"subtrack",next:"root",transform(e,t){let n;if(void 0!==e[1])n=e[1].slice(0,-1);else{const e=t.filter(e=>"BarLine"===e.Type&&e.Order[0]>0);n=e.length>0?Math.max(...e.map(e=>Math.max(...e.Order))):-1}return{Type:"Subtrack",Repeat:n,Content:t}}}},{regex:/^"([^"]*)"/,action:{token:"string",transform:e=>({Type:"String",Content:e[1]})}},{regex:/^\[/,action:{token:"array",next:"Array",transform:(e,t)=>({Type:"Array",Content:t})}},{regex:/^[^,)}[\]"]+/,action:{token:"number",transform:e=>({Type:"Expression",Content:e[0]})}}]},r=[{regex:/^#\s*Chord([^]+?)\r?\n(?=#)/,type:"Chord",transform(e){const t=[],n=e[1].split(/\r?\n/);for(const e of n){const n=e.match(/^([A-Za-z])\t+([^\t]+)\t+([^\t]+)/);if(null===n)continue;const r=n[3].split(","),o=[];for(const e of r){const t=Number(e);if(Number.isNaN(t)){const t=e.trim().match(/\[(.*?)\](-?\d+)?/);let n;if(n=void 0===t[2]?0:Number(t[2]),""===t[1])o.push([1,-1,n]);else{const e=Number(t[1]);if(Number.isNaN(e)){let[e,r]=t[1].split(";");e=Number(e),r=""===r?-1:Number(r),o.push([e,r,n])}else o.push([e,e,n])}}else o.push([1,1,t])}t.push({Notation:n[1],Comment:n[2],Pitches:o})}return{Type:"Chord",Data:t}}},{regex:/^#\s*Function([^]+?)\r?\n(?=#)/,type:"Function",transform:e=>({Type:"Function",Data:[]})},{regex:/^#\s*Track([^]+?)\r?\n(?=#)/,type:"Macro",transform(e){const t=[],n=e[0].match(/<\*\w+\*>[^]+?(?=<\*(\w+)\*>|$)/g);for(const e of n){const[n,r,i]=e.match(/<\*(\w+)\*>([^]+)/);t.push({Name:r,Content:o.tokenizeTrack(i)})}return{Type:"Track",Data:t}}},{regex:/^#\s*End/,type:"@terminal"}];class o{static tokenizeTrack(e){e=e.trim();const t=[[]],r=["root"];let o=0,i=0;for(;i<e.length;){const a=e.slice(i),s=a.trim();i+=a.length-s.length;const c=n[r[o]];for(let e=0;e<c.length;e++){const n=c[e],a=s.match(n.regex);if(null===a)continue;let u;if("next"in(u="cases"in n.action?a[0]in n.action.cases?n.action.cases[a[0]]:n.action.cases["@default"]:n.action))if("@pass"!==u.token&&t[o].push(e=>u.transform(a,e)),"@pop"===u.next){o-=1;const e=t.pop();r.pop(),t[o].push(t[o].pop()(e))}else t.push([]),r.push(u.next),o+=1;else"@pass"!==u.token&&t[o].push(u.transform(a));i+=a[0].length;break}}return t[0]}constructor(e){this.content=e,this.include=[],this.sections=void 0,this.libs=void 0,this.result={Library:[],Sections:[]}}tokenize(){this.regularize(),this.removeComment(),this.extractHeader(),this.split();for(const e of this.sections){const t={Settings:[],Tracks:[]};for(const n of e){const e=o.tokenizeTrack(n),r=e.shift();if(r instanceof Array){const n=r.shift();t.Tracks.push({ID:n,Instruments:r,Content:e})}else t.Settings.push(r,...e)}this.result.Sections.push(t)}return this.result}isHeadTrack(e){const t=["volta","rE","rB"],n=["ConOct","Vol","Spd","Key","Oct","KeyOct","Beat","Bar","BarBeat","Dur","Acct","Light","Seg","Port","Trace","FadeIn","FadeOut","Rev","Ferm","Stac"];return e.every(e=>t.includes(e.token)||"func"===e.token&&n.includes(e.match[1]))}split(){this.sections=this.content.split(/(\r?\n){3,}/).filter(e=>""!==e&&"\n"!==e&&"\r\n"!==e).map(e=>e.split(/\r?\n\r?\n/).filter(e=>""!==e).map(e=>e.replace(/\r?\n/,"")))}regularize(){this.content=this.content.replace(/[ \t\f\v]+(\n|$)/g,"$1")}removeComment(){this.content=this.content.replace(/\/\/.*$/gm,"")}extractHeader(){this.content=this.content.replace(/^#\s*Include\s+"([^"]+)"/gm,(e,t)=>(this.result.Library.push({Type:"Package",Path:t,Content:new i(t,!1).tokenize()}),"")).replace(/[^]*^#\s*End/m,e=>(this.result.Library.push(...new i(e).tokenize()),""))}}class i{constructor(e,t=!0){this.inc=[],this.content=void 0,t?this.content=e.trim():this.load(e)}load(e){this.content="".replace(/^#\s*Include\s+"([^"]+)"/gm,(e,t)=>(this.inc.push(t),""))}tokenize(){const e=[];let t=0;for(const t of this.inc)e.push({Type:"Package",Path:name,Content:new i(t,!1).tokenize()});for(;t<this.content.length;){const n=this.content.slice(t),o=n.trim();t+=n.length-o.length;for(let n=0;n<r.length;n++){const i=r[n],a=o.match(i.regex);if(null!==a){if("@terminal"===i.type)return e;e.push(i.transform(a)),t+=a[0].length;break}}}return e}}e.exports=o},function(e,t,n){const r=n(10);e.exports={Player:r}},function(e,t,n){const r=n(11),o=n(12),i=n(13);class a{constructor(){this.envelopes=[],this.loader=new r(this),this.onCacheFinish=null,this.onCacheProgress=null,this.afterTime=.05}static createChannel(e){return new o(e)}static async createReverberator(e){return await i.create(e)}queueChord(e,t,n,r,o,i,a,s){for(var c=0;c<o.length;c++)this.queueWaveTable(e,t,n,r,o[c],i,a-.01*Math.random(),s)}queueStrumUp(e,t,n,r,o,i,a,s){o.sort((e,t)=>t-e),this.queueStrum(e,t,n,r,o,i,a,s)}queueStrumDown(e,t,n,r,o,i,a,s){o.sort((e,t)=>e-t),this.queueStrum(e,t,n,r,o,i,a,s)}queueStrum(e,t,n,r,o,i,a,s){a?a*=1:a=1,r<e.currentTime&&(r=e.currentTime);for(var c=0;c<o.length;c++)this.queueWaveTable(e,t,n,r+.01*c,o[c],i,a-.01*Math.random(),s),a*=.9}queueSnap(e,t,n,r,o,i,a,s){a=1.5*(1|a),this.queueChord(e,t,n,r,o,.05,a,s)}queueWaveTable(e,t,n,r,o,i,s,c){s?s*=1:s=1;var u=a.findZone(e,n,o);if(u.buffer){var h=u.originalPitch-100*u.coarseTune-u.fineTune,l=1*Math.pow(2,(100*o-h)/1200),d=r;d<e.currentTime&&(d=e.currentTime);var p=i+this.afterTime,g=!0;(u.loopStart<1||u.loopStart>=u.loopEnd)&&(g=!1),g||p>u.buffer.duration/l&&(p=u.buffer.duration/l);var f=this.findEnvelope(e,t,d,p);if(this.setupEnvelope(e,f,u,s,d,p,i),f.audioBufferSourceNode=e.createBufferSource(),f.audioBufferSourceNode.playbackRate.value=l,c&&c.length>0){f.audioBufferSourceNode.playbackRate.setValueAtTime(l,r);for(var m=0;m<c.length;m++){var b=1*Math.pow(2,(100*c[m].pitch-h)/1200),k=r+c[m].when;f.audioBufferSourceNode.playbackRate.linearRampToValueAtTime(b,k)}}return f.audioBufferSourceNode.buffer=u.buffer,g?(f.audioBufferSourceNode.loop=!0,f.audioBufferSourceNode.loopStart=u.loopStart/u.sampleRate+u.delay,f.audioBufferSourceNode.loopEnd=u.loopEnd/u.sampleRate+u.delay):f.audioBufferSourceNode.loop=!1,f.audioBufferSourceNode.connect(f),f.audioBufferSourceNode.start(d,u.delay),f.audioBufferSourceNode.stop(d+p),f.when=d,f.duration=p,f.pitch=o,f.preset=n,f}console.log("empty buffer ",u)}static noZeroVolume(e){return e>a.nearZero?e:a.nearZero}setupEnvelope(e,t,n,r,o,i,s){t.gain.setValueAtTime(a.noZeroVolume(0),e.currentTime);var c=0,u=0,h=s,l=n.ahdsr;i<h+this.afterTime&&(h=i-this.afterTime),l?l.length>0||(l=[{duration:0,volume:1},{duration:.5,volume:1},{duration:1.5,volume:.5},{duration:3,volume:0}]):l=[{duration:0,volume:1},{duration:h,volume:1}],t.gain.cancelScheduledValues(o),t.gain.setValueAtTime(a.noZeroVolume(l[0].volume*r),o);for(var d=0;d<l.length;d++)if(l[d].duration>0){if(l[d].duration+c>h){var p=u-(1-(l[d].duration+c-h)/l[d].duration)*(u-l[d].volume);t.gain.linearRampToValueAtTime(a.noZeroVolume(r*p),o+h);break}c+=l[d].duration,u=l[d].volume,t.gain.linearRampToValueAtTime(a.noZeroVolume(r*u),o+c)}t.gain.linearRampToValueAtTime(a.noZeroVolume(0),o+h+this.afterTime)}static numValue(e,t){return"number"==typeof e?e:t}findEnvelope(e,t){for(var n=null,r=0;r<this.envelopes.length;r++){var o=this.envelopes[r];if(o.target==t&&e.currentTime>o.when+o.duration+.1){try{o.audioBufferSourceNode.disconnect(),o.audioBufferSourceNode.stop(0),o.audioBufferSourceNode=null}catch(e){}n=o;break}}return n||((n=e.createGain()).target=t,n.connect(t),n.cancel=(()=>{n.when+n.duration>e.currentTime&&(n.gain.cancelScheduledValues(0),n.gain.setTargetAtTime(1e-5,e.currentTime,.1),n.when=e.currentTime+1e-5,n.duration=0)}),this.envelopes.push(n)),n}static adjustPreset(e,t){return Promise.all(t.zones.map(t=>a.adjustZone(e,t)))}static adjustZone(e,t){if(!t.buffer)if(t.delay=0,t.loopStart=a.numValue(t.loopStart,0),t.loopEnd=a.numValue(t.loopEnd,0),t.coarseTune=a.numValue(t.coarseTune,0),t.fineTune=a.numValue(t.fineTune,0),t.originalPitch=a.numValue(t.originalPitch,6e3),t.sampleRate=a.numValue(t.sampleRate,44100),t.sustain=a.numValue(t.originalPitch,0),t.sample){const a=atob(t.sample);t.buffer=e.createBuffer(1,a.length/2,t.sampleRate);for(var n,r,o,i=t.buffer.getChannelData(0),s=0;s<a.length/2;s++)n=a.charCodeAt(2*s),r=a.charCodeAt(2*s+1),n<0&&(n=256+n),r<0&&(r=256+r),(o=256*r+n)>=32768&&(o-=65536),i[s]=o/65536}else if(t.file){var c=t.file.length,u=new ArrayBuffer(c),h=new Uint8Array(u);const n=atob(t.file);var l;for(s=0;s<n.length;s++)l=n.charCodeAt(s),h[s]=l;return a.decodeAudioData(e,t,u).then(e=>{t.buffer=e})}}static decodeAudioData(e,t,n){return new Promise((t,r)=>{e.decodeAudioData(n,t,r)})}static findZone(e,t,n){for(var r=null,o=t.zones.length-1;o>=0&&!((r=t.zones[o]).keyRangeLow<=n&&r.keyRangeHigh+1>=n);o--);try{a.adjustZone(e,r)}catch(e){console.log("adjustZone",e)}return r}cancelQueue(e){for(var t=0;t<this.envelopes.length;t++){var n=this.envelopes[t];n.gain.cancelScheduledValues(0),n.gain.setValueAtTime(a.nearZero,e.currentTime),n.when=-1;try{n.audioBufferSourceNode.disconnect()}catch(e){console.log(e)}}}}a.nearZero=1e-6,"object"==typeof e&&e.exports&&(e.exports=a),"undefined"!=typeof window&&(window.WebAudioFontPlayer=a)},function(e,t){class n{constructor(e){this.player=e,this.cached=[]}async load(e,t,n){if(!(n in window.fonts)){const r=localStorage.getItem(n);if(r)window.fonts[n]=JSON.parse(r),await this.player.constructor.adjustPreset(e,window.fonts[n]);else if(-1===this.cached.indexOf(n)){this.cached.push(n);const r=await fetch(t,{mode:"cors"}),o=await r.json();localStorage.setItem(n,JSON.stringify(o)),await this.player.constructor.adjustPreset(e,o),window.fonts[n]=o}}return n}}"object"==typeof e&&e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.WebAudioFontLoader=n)},function(e,t){class n{constructor(e){this.audioContext=e,this.input=this.audioContext.createDynamicsCompressor(),this.input.threshold.value=-3,this.input.knee.value=30,this.input.ratio.value=12,this.input.attack.value=.05,this.input.release.value=.08,this.band32=this.bandEqualizer(this.input,32),this.band64=this.bandEqualizer(this.band32,64),this.band128=this.bandEqualizer(this.band64,128),this.band256=this.bandEqualizer(this.band128,256),this.band512=this.bandEqualizer(this.band256,512),this.band1k=this.bandEqualizer(this.band512,1024),this.band2k=this.bandEqualizer(this.band1k,2048),this.band4k=this.bandEqualizer(this.band2k,4096),this.band8k=this.bandEqualizer(this.band4k,8192),this.band16k=this.bandEqualizer(this.band8k,16384),this.output=e.createGain(),this.band16k.connect(this.output)}bandEqualizer(e,t){const n=this.audioContext.createBiquadFilter();return n.frequency.setTargetAtTime(t,0,1e-4),n.type="peaking",n.gain.setTargetAtTime(0,0,1e-4),n.Q.setTargetAtTime(1,0,1e-4),e.connect(n),n}}"object"==typeof e&&e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.WebAudioFontChannel=n)},function(e,t){class n{constructor(e,t){this.ctx=e,this.input=this.ctx.createBiquadFilter(),this.input.type="lowpass",this.input.frequency.setTargetAtTime(18e3,0,1e-4),this.convolver=null,this.output=e.createGain(),this.dry=e.createGain(),this.dry.gain.setTargetAtTime(.9,0,1e-4),this.dry.connect(this.output),this.wet=e.createGain(),this.wet.gain.setTargetAtTime(.5,0,1e-4),this.input.connect(this.dry),this.input.connect(this.wet),this.irrArrayBuffer=t,this.ctx.decodeAudioData(this.irrArrayBuffer,t=>{this.convolver=e.createConvolver(),this.convolver.buffer=t,this.wet.connect(this.convolver),this.convolver.connect(this.output)})}static async create(e){const t=await fetch("https://jjyyxx.github.io/webaudiofontdata/data/irr.bin",{mode:"cors"}),r=await t.arrayBuffer();return new n(e,r)}}"object"==typeof e&&e.exports&&(e.exports=n),"undefined"!=typeof window&&(window.WebAudioFontReverberator=n)},function(e,t,n){const r=n(15),o=n(20),i=n(21);e.exports={Parser:r,MMAAdapter:o,MIDIAdapter:i}},function(e,t,n){const r=n(16),o=n(19),{TrackParser:i}=n(0);e.exports=class{constructor(e,t){this.tokenizedData=e,this.libraries=new r(this.tokenizedData.Library).load(),this.result={Sections:void 0},this.sectionContext={Settings:new o},this.order=[],this.adapter=t}parse(){const e=[];return this.generateOrder(),this.order.forEach(t=>{e.push(this.parseSection(this.tokenizedData.Sections[t]))}),this.result=e,void 0===this.adapter?e:this.adapter.adapt(e)}generateOrder(){const e=this.tokenizedData.Sections.map(e=>{const t=e.Settings.find(e=>"Volta"===e.Type);let n;return n=t?t.Order:void 0,{RepeatBegin:!!e.Settings.find(e=>"RepeatBegin"===e.Type),RepeatEnd:!!e.Settings.find(e=>"RepeatEnd"===e.Type),Volta:n}}),t=e.length;let n=0,r=0,o=1,i=!0;for(;n<t;){if(e[n].RepeatEnd){if(i&&(e[n].RepeatEnd=!1),1===o){n=r,o+=1;continue}{let i=r,a=!1;for(;i<t&&!e[i].RepeatBegin;){if(e[i].Volta&&-1!==e[i].Volta.indexOf(o+1)){a=!0;break}i+=1}if(a){n=r,o+=1;continue}this.order.push(n),n+=1}}e[n].RepeatBegin?(r=n,e[n].RepeatBegin=!1,o=1):e[n].Volta?-1===e[n].Volta.indexOf(o)?n+=1:(e[n].Volta.splice(e[n].Volta.indexOf(o),1),i=0===e[n].Volta.length,this.order.push(n),n+=1):(this.order.push(n),n+=1)}}parseSection(e){e.Settings.filter(e=>"FUNCTION"===e.Type).forEach(e=>this.libraries.FunctionPackage.applyFunction({Settings:this.sectionContext.Settings,Context:{}},e));const t={};return{ID:e.ID,Tracks:[].concat(...e.Tracks.map(e=>{const n=new i(e,this.sectionContext.Settings,this.libraries).parseTrack();for(const r of n)r.Instrument in t?t[r.Instrument]+=1:t[r.Instrument]=1,""===e.ID&&(r.ID+="#"+t[r.Instrument].toString());return n}))}}}},function(module,exports,__webpack_require__){const{SubtrackParser:SubtrackParser}=__webpack_require__(0);class LibLoader{constructor(e=[],t=!0){this.libs=e,this.result={Chord:{},MetaInformation:{},FunctionPackage:{Custom:{}},MIDIEventList:{},Track:{}},t&&Object.assign(this.result,LibLoader.Default)}load(){for(const e of this.libs)this.loadLibrary(e);return this.result}loadLibrary(e){switch(e.Type){case LibLoader.libType.Chord:e.Data.forEach(e=>{this.result.Chord[e.Notation]=e.Pitches});break;case LibLoader.libType.Track:for(const t of e.Data)this.result.Track[t.Name]=t.Content;break;case LibLoader.libType.MetaInformation:break;case LibLoader.libType.FunctionPackage:this.loadCode(e.Data);break;case LibLoader.libType.MIDIEventList:break;case LibLoader.libType.Library:this.loadSubPackage(e.Content)}}loadCode(data){const code="this.result.FunctionPackage.Custom = {"+data.map(e=>e.Code).join(",")+"}";eval(code)}loadSubPackage(e){const t=new LibLoader(e,!1).load();Object.assign(this.result.Chord,t.Chord),Object.assign(this.result.FunctionPackage.Custom,t.FunctionPackage.Custom),Object.assign(this.result.MetaInformation,t.MetaInformation),Object.assign(this.result.MIDIEventList,t.MIDIEventList),Object.assign(this.result.Track,t.Track)}}LibLoader.libType={Chord:"Chord",MetaInformation:"MetaInformation",FunctionPackage:"Function",MIDIEventList:"MIDIEventList",Library:"Package",Track:"Track"},LibLoader.Default={Chord:{M:[[1,1,0],[1,1,4],[1,1,7]],m:[[1,1,0],[1,1,3],[1,1,7]],a:[[1,1,0],[1,1,4],[1,1,8]],d:[[1,1,0],[1,1,3],[1,1,6]],t:[[1,-1,0],[1,1,3]],T:[[1,-1,0],[1,1,4]],q:[[1,-1,0],[1,1,5]],Q:[[1,-1,0],[1,1,6]],p:[[1,-1,0],[1,1,7]],P:[[1,-1,0],[1,1,8]],h:[[1,-1,0],[1,1,9]],H:[[1,-1,0],[1,1,10]],s:[[1,-1,0],[1,1,11]],o:[[1,-1,0],[1,1,12]],u:[[-1,-1,-12],[1,-1,0]],i:[[1,1,12],[2,-1,0]],j:[[1,2,12],[3,-1,0]],k:[[1,3,12],[4,-1,0]]},MetaInformation:{},FunctionPackage:{STD:__webpack_require__(18),Custom:{},applyFunction(parser,token){return this.locateFunction(token.Name).apply({Settings:parser.Settings,Libraries:parser.Libraries,pitchQueue:parser.Context.pitchQueue},token.Argument.map(arg=>{switch(arg.Type){case"Number":case"String":return arg.Content;case"Expression":return eval(arg.Content.replace(/Log2/g,"Math.log2"));default:return arg}}))},locateFunction(e){return e in this.STD?this.STD[e]:e in this.Custom?this.Custom[e]:()=>{}}},MIDIEventList:{},Track:{}},module.exports=LibLoader},function(e,t){class n extends Error{constructor(e,t,...n){super(t),this.name=e,this.args=n}toJSON(){return{ErrID:this.name,Args:this.args}}}e.exports={BarLengthError:class extends n{constructor(e,t,n){super("BarLength","",e,t,n)}},DupChordError:class extends n{constructor(e,t,n){super("DupChord","",e,t,n)}},TraceError:class extends n{constructor(e,t,n){super("Trace","",e,t,n)}},VolumeError:class extends n{constructor(e,t,n){super("Trace","",e,t,n)}}}},function(e,t,n){const{SubtrackParser:r}=n(0);e.exports={Tremolo1(e,t){const n=new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),o=60*Math.pow(2,-e)/this.Settings.Speed,i=Math.round(n.Meta.Duration/o),a=[],s=n.Content.length;for(let e=0;e<i;e++){const t=e*o;for(let e=0;e<s;e++)a.push(Object.assign({},n.Content[e],{StartTime:t,Duration:o}))}return{Content:a,Meta:n.Meta}},Tremolo2(e,t,n){const o=[new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),new r(n,this.Settings,this.Libraries,this.pitchQueue).parseTrack()],i=60*Math.pow(2,-e)/this.Settings.Speed,a=Math.round(o[1].Meta.Duration/i),s=o.map(e=>e.Content.length),c=[];for(let e=0;e<a;e++){const t=e*i,n=e%2;for(let e=0;e<s[n];e++)c.push(Object.assign({},o[n].Content[e],{StartTime:t,Duration:i}))}return{Content:c,Meta:{Duration:o[1].Meta.Duration,Incomplete:o[1].Meta.Incomplete,Single:!0,Warnings:[],PitchQueue:[...o[0].Meta.PitchQueue,...o[1].Meta.PitchQueue],NotesBeforeTie:o[(a-1)%2].Meta.NotesBeforeTie}}},Tuplet(e,t){const n=Math.pow(2,Math.floor(Math.log2(e)))/e,o=new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack();return o.Content.forEach(e=>{e.Duration*=n,e.StartTime*=n}),o.Meta.Duration*=n,o},Portamento(e,t){const n=new r(e,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),o=new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),i=n.Content[0].Pitch,a=o.Content[0].Pitch,s=n.Meta.Duration,c=this.Settings.getOrSetDefault("Port",6),u=(a-i)/(s*c-1),h=[];for(let e=0;e<c;e++)h.push(Math.round(i+u*e));const l=h.map((e,t)=>({Type:"Note",Pitch:e,Volume:o.Content[0].Volume,Duration:1/c,StartTime:t/c}));return{Content:l,Meta:{Duration:s,Incomplete:[s],Single:!0,Warnings:[],PitchQueue:[...n.Meta.PitchQueue,...o.Meta.PitchQueue],NotesBeforeTie:[l[l.length-1]]}}},GraceNote(e,t){const n=new r(e,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),o=new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),i=e.Content.length;let a;const s=this.Settings.getOrSetDefault("Seg",.25),c=(a=i<=4?s/4:s/i)*Math.pow(2,-this.Settings.Duration)*60/this.Settings.Speed;n.Content.forEach(e=>{e.Duration=c,e.StartTime*=a});const u=c*i;return o.Content.forEach(e=>{e.StartTime+=u,e.Duration-=u}),{Content:[...n.Content,...o.Content],Meta:o.Meta}},Appoggiatura(e,t){const n=new r(e,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),o=new r(t,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),i=t.Content.length;let a;const s=this.Settings.getOrSetDefault("Seg",.25),c=(a=i<=4?s/4:s/i)*Math.pow(2,-this.Settings.Duration)*60/this.Settings.Speed,u=c*i;return n.Content.forEach(e=>{e.Duration-=u}),o.Content.forEach(e=>{e.Duration=c,e.StartTime*=a,e.StartTime+=n.Content[0].Duration}),{Content:[...n.Content,...o.Content],Meta:n.Meta}},Fermata(e){const t=new r(e,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),n=this.Settings.getOrSetDefault("Ferm",2);return t.Content.forEach(e=>{e.Duration*=n,e.StartTime*=n}),t.Meta.Duration*=n,t},Arpeggio(e){const t=new r(e,this.Settings,this.Libraries,this.pitchQueue).parseTrack(),n=t.Content.length-1;let o;const i=this.Settings.getOrSetDefault("Seg",.25),a=(o=n<=4?i/4:i/n)*Math.pow(2,-this.Settings.Duration)*60/this.Settings.Speed,s=[];return t.Content.reduce((e,r,o)=>{if(o<n){const t=Object.assign({},r);e.push(t),t.Duration=a;for(const t of e)s.push(Object.assign({},t,{StartTime:a*o}))}else t.Content.forEach(e=>{e.StartTime+=a*o,e.Duration-=a*o}),s.push(...t.Content);return e},[]),Object.assign(t,{Content:s})},ConOct(e=0,t=1){this.Settings.assignSetting("ConOct",e,e=>Number.isInteger(e)),this.Settings.assignSetting("ConOctVolume",t,e=>e>=0)},Vol(e){this.Settings.assignSetting("Volume",e/100,e=>e>=0)},Spd(e){this.Settings.assignSetting("Speed",e,e=>e>0)},Key(e){this.Settings.assignSetting("Key",e,e=>Number.isInteger(e))},Oct(e){this.Settings.assignSetting("Octave",e,e=>Number.isInteger(e))},KeyOct(e){let t,n,r;e.endsWith("'")?(r=e.indexOf("'"),t=e.slice(0,r),n=e.length-r):e.endsWith(",")?(r=e.indexOf(","),t=e.slice(0,r),n=r-e.length):(t=e,n=0);this.Settings.assignSetting("Key",{C:0,G:7,D:2,A:9,E:4,B:-1,"#F":6,"#C":1,F:5,bB:-2,bE:3,bA:8,bD:1,bG:6,bC:-1,"F#":6,"C#":1,Bb:-2,Eb:3,Ab:8,Db:1,Gb:6,Cb:-1}[t],e=>Number.isInteger(e)),this.Settings.assignSetting("Octave",n,e=>Number.isInteger(e))},Beat(e){this.Settings.assignSetting("Beat",e,e=>e>0&&Number.isInteger(Math.log2(e)))},Bar(e){this.Settings.assignSetting("Bar",e,e=>e>0&&Number.isInteger(e))},BarBeat(e,t){this.Settings.assignSetting("Bar",e,e=>e>0&&Number.isInteger(e)),this.Settings.assignSetting("Beat",t,e=>e>0&&Number.isInteger(Math.log2(e)))},Dur(e){this.Settings.assignSetting("Duration",e,()=>!0)},Acct(e){this.Settings.assignSetting("Accent",e,e=>e>1)},Light(e){this.Settings.assignSetting("Light",e,e=>e<1&&e>0)},Seg(e){this.Settings.assignSetting("Seg",e,e=>e>0)},Port(e){this.Settings.assignSetting("Port",e,e=>e>0)},Trace(e){this.Settings.assignSetting("Trace",e,e=>e>0&&e<=4&&Number.isInteger(e))},FadeIn(e){this.Settings.assignSetting("FadeIn",e,e=>e>=0)},FadeOut(e){this.Settings.assignSetting("FadeOut",e,e=>e>=0)},Rev(e){this.Settings.assignSetting("Rev",e,()=>!0)},Ferm(e){this.Settings.assignSetting("Ferm",e,e=>e>1)},Stac(e,t=1){if("number"!=typeof e)throw new TypeError("Non-numeric value passed in as Stac");if(!(e=>e>=0&&e<=1)(e))throw new RangeError("Stac out of range");if(![0,1,2].includes(t))throw new RangeError("Stac index out of range");this.Settings.Stac[t]=e}}},function(e,t){class n{constructor({Key:e=0,Bar:t=4,Beat:n=4,Speed:r=60,Volume:o=1,Stac:i=[0,.5,.75],Accent:a=2,Light:s=.5,Trace:c=1,Duration:u=0,Oct:h=0,FadeIn:l=0,FadeOut:d=0,Rev:p=0,ConOct:g=0,ConOctVolume:f=1}={}){this.Key=e,this.Bar=t,this.Beat=n,this.Speed=r,this.Volume=o,this.Stac=i,this.Accent=a,this.Light=s,this.Trace=c,this.Duration=u,this.Octave=h,this.FadeIn=l,this.FadeOut=d,this.Rev=p,this.ConOct=g,this.ConOctVolume=f,this.Var={}}getOrSetDefault(e,t){return e in this?this[e]:(t&&(this[e]=t),t)}extend(e={Stac:this.Stac.slice()}){const t=new n;return Object.assign(t,this,e),t}update(e){Object.assign(this,e)}assignSetting(e,t,n){if("number"!=typeof t)throw new TypeError(`Non-numeric value passed in as ${e}`);if(!n(t))throw new RangeError(`${e} out of range`);this[e]=t}}e.exports=n},function(e,t){e.exports=class{constructor(){}adapt(e){let t=0;const n=[],r={Meta:{FadeIn:0,FadeOut:0,Duration:0},Content:[]};for(const o of e){const e=[];for(const i of o.Tracks){e.push(i.Meta.Duration),0===i.Meta.FadeIn&&0===i.Meta.FadeOut?(r.Content.push(...i.Content),r.Meta.Duration+=i.Meta.Duration):n.push(i);for(const e of i.Content)e.Instrument=i.Instrument,e.StartTime+=t}t+=Math.max(...e)}return r.Meta.Duration>0&&n.push(r),n}}},function(e,t){e.exports=class{constructor(){}adapt(e){let t=0;const n={};for(const r of e){const e=[];for(const o of r.Tracks){e.push(o.Meta.Duration);for(const e of o.Content)e.StartTime+=t;o.ID in n?(n[o.ID].Meta.Duration+=o.Meta.Duration,n[o.ID].Content.push(...o.Content)):n[o.ID]=o}t+=Math.max(...e)}return Object.values(n)}}},function(e,t,n){"use strict";t.d={Piano:0,BrightPiano:1,ElectricGrandPiano:2,HonkyTonkPiano:3,ElectricPiano:4,ElectricPiano2:5,Harpsichord:6,Clavi:7,Celesta:8,Glockenspiel:9,MusicBox:10,Vibraphone:11,Marimba:12,Xylophone:13,TubularBells:14,Dulcimer:15,DrawbarOrgan:16,PercussiveOrgan:17,RockOrgan:18,Organ:19,ReedOrgan:20,Accordion:21,Harmonica:22,Bandoneon:23,Guitar:24,SteelGuitar:25,JazzGuitar:26,ElectricGuitar:27,GuitarMuted:28,GuitarOverdriven:29,GuitarDistorted:30,GuitarHarmonics:31,Bass:32,ElectricBass:33,PickedBass:34,FretlessBass:35,SlapBass:36,SlapBass2:37,SynthBass:38,SynthBass2:39,Violin:40,Viola:41,Cello:42,Contrabass:43,TremoloStrings:44,PizzicatoStrings:45,Harp:46,Timpani:47,Strings:48,Strings2:49,SynthStrings:50,SynthStrings2:51,VoiceAahs:52,VoiceOohs:53,Voice:54,OrchestraHit:55,Trumpet:56,Trombone:57,Tuba:58,MutedTrumpet:59,FrenchHorn:60,BrassSection:61,SynthBrass:62,SynthBrass2:63,SopranoSax:64,AltoSax:65,TenorSax:66,BaritoneSax:67,Oboe:68,EnglishHorn:69,Bassoon:70,Clarinet:71,Piccolo:72,Flute:73,Recorder:74,PanFlute:75,BlownBottle:76,Shakuhachi:77,Whistle:78,Ocarina:79,Square:80,Sawtooth:81,Calliope:82,Chiff:83,Charang:84,SynthVoice:85,Fifths:86,BassAndLead:87,NewAge:88,Warm:89,Polysynth:90,Choir:91,Bowed:92,Metallic:93,Halo:94,Sweep:95,Rain:96,Soundtrack:97,Crystal:98,Atmosphere:99,Brightness:100,Goblins:101,Echoes:102,SciFi:103,Sitar:104,Banjo:105,Shamisen:106,Koto:107,Kalimba:108,Bagpipe:109,Fiddle:110,Shanai:111,Tinklebell:112,Agogo:113,Steeldrums:114,Woodblock:115,Taiko:116,MelodicTom:117,SynthDrum:118,ReverseCymbal:119,FretNoise:120,Breath:121,Seashore:122,Bird:123,Telephone:124,Helicopter:125,Applause:126,Gunshot:127};t.c={BassDrum2:35,BassDrum:36,SideStick:37,Snare:38,Clap:39,ElectricSnare:40,LowFloorTom:41,HiHatClosed:42,LowTom:43,HiHatPedal:44,MidTom2:45,HiHatOpen:46,MidTom:47,HighFloorTom:48,CrashCymbal:49,HighTom:50,RideCymbal:51,ChineseCymbal:52,RideBell:53,Tambourine:54,SplashCymbal:55,Cowbell:56,CrashCymbal2:57,Vibraslap:58,RideCymbal2:59,HighBongo:60,LowBongo:61,HighCongaMute:62,HighCongaOpen:63,LowConga:64,HighTimbale:65,LowTimbale:66,HighAgogo:67,LowAgogo:68,Cabasa:69,Maracas:70,WhistleShort:71,WhistleLong:72,GuiroShort:73,GuiroLong:74,Claves:75,HighWoodblock:76,LowWoodblock:77,MuteCuica:78,OpenCuica:79,MuteTriangle:80,OpenTriangle:81};t.a="https://jjyyxx.github.io/webaudiofontdata/data/";t.b="Piano"}]);